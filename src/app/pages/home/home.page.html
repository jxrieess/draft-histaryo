<ion-header [translucent]="true" class="custom-header">
  <ion-toolbar>
    <ion-title>
      <div class="header-brand">
        <span class="brand-name">HistARyo</span>

      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="goToProfile()">
        <ion-icon name="person-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="openNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
        <ion-badge color="danger" *ngIf="unreadNotifications > 0">{{unreadNotifications}}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">
        <div class="header-brand">
          <span class="brand-name">HistARyo</span>
          <span class="capstone-badge">Capstone Project</span>
        </div>
      </ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      pullingText="Pull to refresh"
      refreshingSpinner="crescent"
      refreshingText="Discovering new content...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="main-content">
    <div class="hero-section">
      <div class="hero-background">
        <img 
          src="assets/img/onboarding.jpg" 
          alt="Cebu Heritage Site" 
          class="hero-image"
          loading="eager" />
        <div class="hero-overlay"></div>
      </div>
      
      <div class="hero-content">
        <div class="hero-text">
          <div class="welcome-badge">
            <ion-icon name="school"></ion-icon>
            <span>Cebu Heritage AR</span>
          </div>
          
          <h1 class="hero-title">
            {{ getGreeting() }}!<br />
            <span class="gradient-text">Explore Cebu's Heritage</span>
          </h1>
          
          <p class="hero-description">
            Showcasing Cebu's rich cultural heritage through immersive AR technology. 
            Experience history like never before with interactive landmarks, educational content, and gamified exploration.
          </p>
        </div>

        <div class="hero-stats" *ngIf="hasUserData">
          <div class="stat-item">
            <span class="stat-number">{{ totalLandmarksCount }}</span>
            <span class="stat-label">Heritage Sites</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ userStats.stampsCollected }}</span>
            <span class="stat-label">Stamps Collected</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ userStats.streakDays }}</span>
            <span class="stat-label">Day Streak</span>
          </div>
        </div>
      </div>
    </div>

    <div class="quick-actions">
      <div class="action-cards">
        <ion-card 
          class="action-card scan-card" 
          button="true"
          (click)="navigateToScan()">
          <ion-card-content>
            <div class="card-icon gradient-primary">
              <ion-icon name="qr-code"></ion-icon>
            </div>
            <div class="card-content">
              <h3>AR Experience</h3>
              <p>Scan QR codes to unlock immersive augmented reality content</p>
            </div>
          </ion-card-content>
        </ion-card>
        
        <ion-card 
          class="action-card map-card" 
          button="true"
          (click)="navigateToMap()">
          <ion-card-content>
            <div class="card-icon gradient-accent">
              <ion-icon name="map"></ion-icon>
            </div>
            <div class="card-content">
              <h3>Interactive Map</h3>
              <p>Explore Cebu's heritage sites with detailed location information</p>
            </div>
          </ion-card-content>
        </ion-card>
        
        <ion-card 
          class="action-card progress-card" 
          button="true"
          (click)="navigateToProgress()">
          <ion-card-content>
            <div class="card-icon gradient-success">
              <ion-icon name="trophy"></ion-icon>
            </div>
            <div class="card-content">
              <h3>Project Analytics</h3>
              <p>View user engagement metrics and exploration statistics</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <div class="loading-container" *ngIf="loading">
      <div class="shimmer-cards">
        <div class="shimmer-card" *ngFor="let item of [1,2,3,4]"></div>
      </div>
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Loading data...</p>
    </div>

    <div class="error-container" *ngIf="error && !loading">
      <ion-icon name="warning-outline" color="danger" size="large"></ion-icon>
      <h3>Oops! Something went wrong</h3>
      <p>{{ error }}</p>
      <ion-button (click)="loadContent()" fill="outline" color="primary">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Try Again
      </ion-button>
    </div>

    <div class="featured-section" *ngIf="featuredLandmarks && featuredLandmarks.length > 0">
      <div class="section-header">
        <h2 class="section-title">
          <ion-icon name="star-outline" class="section-icon"></ion-icon>
          Featured Heritage Sites
        </h2>
        <ion-button 
          fill="clear" 
          size="small" 
          (click)="navigateToAllLandmarks()">
          View All ({{ totalLandmarksCount }})
          <ion-icon name="chevron-forward" slot="end"></ion-icon>
        </ion-button>
      </div>
      
      <div class="landmarks-scroll">
        <ion-card 
          class="landmark-card featured-card"
          *ngFor="let landmark of featuredLandmarks; trackBy: trackByLandmarkId"
          button="true"
          (click)="navigateToLandmark(landmark)">
          
          <div class="card-image-container">
            <img 
              [src]="getDefaultImageUrl(landmark.imageUrl, landmark.category)" 
              [alt]="landmark.name"
              class="card-image"
              loading="lazy" 
              (error)="onImageError($event)" />
            
            <div class="card-badges" *ngIf="landmark.difficulty">
              <ion-chip 
                [color]="getDifficultyColor(landmark.difficulty)"
                class="difficulty-chip">
                <ion-icon [name]="getDifficultyIcon(landmark.difficulty)"></ion-icon>
                <ion-label>{{ landmark.difficulty }}</ion-label>
              </ion-chip>
            </div>

            <div class="special-features" *ngIf="hasSpecialFeatures(landmark)">
              <ion-chip 
                *ngFor="let feature of getSpecialFeatures(landmark)"
                color="primary" 
                class="feature-chip">
                {{ feature }}
              </ion-chip>
            </div>
          </div>
          
          <ion-card-content>
            <div class="landmark-info">
              <h3 class="landmark-title">{{ landmark.name }}</h3>
              <p class="landmark-description">
                {{ getShortDescription(landmark.description, 100) }}
              </p>
              
              <div class="landmark-meta">
                <div class="meta-item" *ngIf="landmark.distance">
                  <ion-icon name="location-outline"></ion-icon>
                  <span>{{ getLandmarkDistance(landmark) }}</span>
                </div>
                
                <div class="meta-item" *ngIf="landmark.estimatedTime">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>{{ getEstimatedTime(landmark) }}</span>
                </div>
                
                <div class="meta-item" *ngIf="landmark.rating">
                  <ion-icon name="star" color="warning"></ion-icon>
                  <span>{{ landmark.rating.toFixed(1) }}</span>
                </div>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <div class="nearby-section" *ngIf="nearbyLandmarks && nearbyLandmarks.length > 0">
      <div class="section-header">
        <h2 class="section-title">
          <ion-icon name="navigate-outline" class="section-icon"></ion-icon>
          {{ userLocation ? 'Nearby Heritage Sites' : 'Available Heritage Sites' }}
        </h2>
        <ion-button 
          fill="clear" 
          size="small" 
          (click)="navigateToMap()">
          View on Map
          <ion-icon name="map-outline" slot="end"></ion-icon>
        </ion-button>
      </div>
      
      <div class="landmarks-list">
        <ion-item 
          *ngFor="let landmark of nearbyLandmarks; trackBy: trackByLandmarkId"
          button="true"
          (click)="navigateToLandmark(landmark)"
          class="landmark-item">
          
          <ion-thumbnail slot="start">
            <img 
              [src]="getDefaultImageUrl(landmark.imageUrl, landmark.category)" 
              [alt]="landmark.name"
              loading="lazy"
              (error)="onImageError($event)" />
          </ion-thumbnail>
          
          <ion-label>
            <h3>{{ landmark.name }}</h3>
            <p>{{ getShortDescription(landmark.description, 80) }}</p>
            
            <div class="item-meta">
              <span *ngIf="landmark.distance" class="distance-badge">
                <ion-icon name="location"></ion-icon>
                {{ getLandmarkDistance(landmark) }}
              </span>
              
              <span *ngIf="landmark.category" class="category-badge">
                {{ landmark.category }}
              </span>
              
              <span *ngIf="landmark.estimatedTime" class="time-badge">
                <ion-icon name="time"></ion-icon>
                {{ getEstimatedTime(landmark) }}
              </span>
            </div>
          </ion-label>
          
          <ion-icon name="chevron-forward" slot="end" color="medium"></ion-icon>
        </ion-item>
      </div>
    </div>

    <div class="empty-state" *ngIf="!loading && !error && (!hasLandmarks)">
      <ion-icon name="compass-outline" size="large" color="medium"></ion-icon>
      <h3>No Heritage Sites Available</h3>
      <p>Check back soon for new discoveries!</p>
      <ion-button (click)="loadContent()" fill="outline" color="primary">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Refresh
      </ion-button>
    </div>

    <div class="capstone-info" *ngIf="totalLandmarksCount > 0">
      <ion-card>
        <ion-card-content>
          <div class="info-content">
            <ion-icon name="school" color="primary" size="large"></ion-icon>
            <div class="info-text">
              <h3>Cebu Heritage AR</h3>
              <p>This showcases {{ totalLandmarksCount }} carefully researched heritage sites in Cebu, Philippines. Built using AR capabilities to create an immersive educational experience.</p>
            </div>
          </div>
          
          <ion-button expand="block" fill="outline" (click)="navigateToAllLandmarks()" class="view-all-btn">
            <ion-icon name="library" slot="start"></ion-icon>
            Explore All Heritage Sites
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <div class="cta-section" *ngIf="hasLandmarks">
      <ion-card class="cta-card">
        <ion-card-content>
          <div class="cta-content">
            <h3>Experience the Exploration</h3>
            <p>Explore {{ totalLandmarksCount }} heritage sites and discover the rich cultural history of Cebu through this innovative AR-powered application.</p>
            
            <div class="cta-buttons">
              <ion-button expand="block" (click)="exploreRandomLandmark()">
                <ion-icon name="shuffle" slot="start"></ion-icon>
                Random Heritage Site
              </ion-button>
              
              <ion-button expand="block" fill="outline" (click)="navigateToMap()">
                <ion-icon name="map" slot="start"></ion-icon>
                View Interactive Map
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

  </div>

  <div class="capstone-footer">
    <ion-card>
      <ion-card-content>
        <div class="footer-content">
          <div class="project-info">
            <h4>HistARyo</h4>
            <p>An innovative AR-powered mobile application showcasing Cebu's cultural heritage</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" (click)="navigateToScan()">
      <ion-icon name="qr-code"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>